name: Strip Credentials

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  check-credentials:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check for leaked credentials
        run: |
          echo "Checking for leaked Firebase credentials..."

          # Check for real Firebase API keys (AIzaSy followed by 33 chars)
          if grep -rE "AIzaSy[a-zA-Z0-9_-]{33}" --include="*.cs" --include="*.json" --include="*.razor" .; then
            echo "ERROR: Real Firebase API key detected!"
            exit 1
          fi

          # Check for real Firebase project IDs (project-name with numbers)
          if grep -rE '\.WithProject\("[a-z]+-[0-9]+"\)' --include="*.cs" .; then
            echo "ERROR: Real Firebase project ID detected!"
            exit 1
          fi

          # Check for real App IDs (format: 1:number:web:hex)
          if grep -rE '"1:[0-9]+:web:[a-f0-9]+"' --include="*.cs" --include="*.json" .; then
            echo "ERROR: Real Firebase App ID detected!"
            exit 1
          fi

          # Check for firebase-credentials.local.json being tracked
          if git ls-files | grep -q "firebase-credentials.local.json"; then
            echo "ERROR: firebase-credentials.local.json should not be tracked!"
            exit 1
          fi

          echo "No leaked credentials found!"
